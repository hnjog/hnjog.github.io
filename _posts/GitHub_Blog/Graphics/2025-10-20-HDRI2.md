---
title: "HDRI 2"
date : "2025-10-20 12:00:00 +0900"
last_modified_at: "2025-10-20T12:00:00"
categories:
  - 그래픽스
  - DirectX
tags:
  - HDRI
---


## HDRI 2 (High Dynamic Range Image)

### Tone Mapping

[![Image](https://github.com/user-attachments/assets/5feb4e42-fb73-4e37-84b1-88c40b6645ef)](https://github.com/user-attachments/assets/5feb4e42-fb73-4e37-84b1-88c40b6645ef){: .image-popup}<br>

이미지에서 표현하는 '너무 밝은 색'을<br>
우리의 모니터로 표현하기 위하여 '조정'하는 것을<br>
Tone Mapping이라 한다<br>

- HDRI를 LDR 용 디스플레이에 '맞게' 변환<br>

- Exposure(노출)<br>
  : 전체 밝기 조절 (곱셈)<br>

- Gamma (색감)<br>
  : 전체 색감 보정 (pow)<br>
  (톤 매핑 결과를 '디스플레이'에 맞도록 보정함)<br>


[![Image](https://github.com/user-attachments/assets/eca9191d-ddd4-40b3-86f0-5bbaffdfeb6c)](https://github.com/user-attachments/assets/eca9191d-ddd4-40b3-86f0-5bbaffdfeb6c){: .image-popup}<br>

- ToneMapping 결과는 1:1 의 선형적인 수치에서의 결과<br>

- 디스플레이에서 '빛'에 비해 표현되는 수치가 대략 2.2이기에<br>
  이에 따른 1/2.2 적용을 처리하는 방식<br>
  (CRT Gamma 그래프)<br>

- 그렇기에 감마수치를 낮추는 경우<br>
  왼쪽으로 가며, '밝은 수치'는 비교적 남아 있으나<br>
  중간 / 어두운 색은 더 빨리 어두워짐<br>

적용 과정<br>

```scss
[HDR SceneColor]
    ↓ (Exposure)
[조정된 밝기]
    ↓ (Tone Mapping)
[LDR 색상]
    ↓ (Gamma)
[화면 출력]
```

## 예제 - Tone Mapping 확인

### HDRI (exr)

[![Image](https://github.com/user-attachments/assets/9eb9c3cf-1e17-4557-b732-31c57d3fb644)](https://github.com/user-attachments/assets/9eb9c3cf-1e17-4557-b732-31c57d3fb644){: .image-popup}<br>

- Exposure를 낮추어도 '밝게 빛나는 곳'은 여전히 밝은 상황<br>
  (전체적인 밝기는 낮아졌지만, 여전히 빛나는 느낌을 줄 수 있음)<br>


### LDR (jpg)

[![Image](https://github.com/user-attachments/assets/014c82cb-4086-48d0-b4bc-2d68dd489b4b)](https://github.com/user-attachments/assets/014c82cb-4086-48d0-b4bc-2d68dd489b4b){: .image-popup}<br>

- Exposure를 낮추니 전체적으로 밝기가 낮아지는 모습<br>


[![Image](https://github.com/user-attachments/assets/19238720-a9da-4fe9-b33d-3bcd8875141a)](https://github.com/user-attachments/assets/19238720-a9da-4fe9-b33d-3bcd8875141a){: .image-popup}<br>

- Gamma 수치를 조정해주니 HDRI와 비슷한 연출은 가능<br>


### HLSL (Pixel Shader)

```cpp
float3 LinearToneMapping(float3 color)
{
    float3 invGamma = float3(1, 1, 1) / gamma;

    color = clamp(exposure * color, 0., 1.);
    color = pow(color, invGamma);
    return color;
}

...

if (useAlbedoTexture)
{
    // 임시로 색 대입
    float3 albedo = g_albedoTexture.SampleLevel(g_sampler, input.texcoord, lod).rgb;
    diffuse.xyz = LinearToneMapping(albedo);
}
```

- Exposure 수치와 Gamma 수치를 Imgui로 입력받아 그 색을 return<br>

- 여기서는 대입하지만 곱셈이 맞는 방식<br>
  (톤 매핑의 효과를 보기 위함)<br>

- 렌더링 결과에 이러한 톤매핑이 적용이 가능하나<br>
  PBR을 진행한 후, 다시 알아볼 예정<br>

[![Image](https://github.com/user-attachments/assets/6962c175-7200-4078-9731-ddd54986f98a)](https://github.com/user-attachments/assets/6962c175-7200-4078-9731-ddd54986f98a){: .image-popup}<br>

- HDRI를 잘 사용하려면<br>
  '여러 노출' 값을 조정한 `이미지들`을<br>
  잘 합성하여 만드는 방식<br>
  (Multi-exposure HDR Capture)

- Tone Mapping 역시 [Shader Toy](https://www.shadertoy.com/) 에 많이 존재하니<br>
  필요에 따라 검색해서 찾아보자!<br>

